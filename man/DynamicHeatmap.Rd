% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/DynamicHeatmap.R
\name{DynamicHeatmap}
\alias{DynamicHeatmap}
\title{Heatmap plot for dynamic features along lineages}
\usage{
DynamicHeatmap(
  srt,
  lineages,
  features = NULL,
  use_fitted = FALSE,
  border = TRUE,
  flip = FALSE,
  min_expcells = 20,
  r.sq = 0.2,
  dev.expl = 0.2,
  padjust = 0.05,
  num_intersections = NULL,
  cell_density = 1,
  cell_bins = 100,
  order_by = c("peaktime", "valleytime"),
  layer = "counts",
  assay = NULL,
  exp_method = c("zscore", "raw", "fc", "log2fc", "log1p"),
  exp_legend_title = NULL,
  limits = NULL,
  lib_normalize = identical(layer, "counts"),
  libsize = NULL,
  family = NULL,
  cluster_features_by = NULL,
  cluster_rows = FALSE,
  cluster_row_slices = FALSE,
  cluster_columns = FALSE,
  cluster_column_slices = FALSE,
  show_row_names = FALSE,
  show_column_names = FALSE,
  row_names_side = ifelse(flip, "left", "right"),
  column_names_side = ifelse(flip, "bottom", "top"),
  row_names_rot = 0,
  column_names_rot = 90,
  row_title = NULL,
  column_title = NULL,
  row_title_side = "left",
  column_title_side = "top",
  row_title_rot = 0,
  column_title_rot = ifelse(flip, 90, 0),
  feature_split = NULL,
  feature_split_by = NULL,
  n_split = NULL,
  split_order = NULL,
  split_method = c("mfuzz", "kmeans", "kmeans-peaktime", "hclust", "hclust-peaktime"),
  decreasing = FALSE,
  fuzzification = NULL,
  anno_terms = FALSE,
  anno_keys = FALSE,
  anno_features = FALSE,
  terms_width = grid::unit(4, "in"),
  terms_fontsize = 8,
  keys_width = grid::unit(2, "in"),
  keys_fontsize = c(6, 10),
  features_width = grid::unit(2, "in"),
  features_fontsize = c(6, 10),
  IDtype = "symbol",
  species = "Homo_sapiens",
  db_update = FALSE,
  db_version = "latest",
  db_combine = FALSE,
  convert_species = FALSE,
  Ensembl_version = NULL,
  mirror = NULL,
  db = "GO_BP",
  TERM2GENE = NULL,
  TERM2NAME = NULL,
  minGSSize = 10,
  maxGSSize = 500,
  GO_simplify = FALSE,
  GO_simplify_cutoff = "p.adjust < 0.05",
  simplify_method = "Wang",
  simplify_similarityCutoff = 0.7,
  pvalueCutoff = NULL,
  padjustCutoff = 0.05,
  topTerm = 5,
  show_termid = FALSE,
  topWord = 20,
  words_excluded = NULL,
  nlabel = 20,
  features_label = NULL,
  label_size = 10,
  label_color = "black",
  pseudotime_label = NULL,
  pseudotime_label_color = "black",
  pseudotime_label_linetype = 2,
  pseudotime_label_linewidth = 3,
  heatmap_palette = "viridis",
  heatmap_palcolor = NULL,
  pseudotime_palette = "cividis",
  pseudotime_palcolor = NULL,
  feature_split_palette = "simspec",
  feature_split_palcolor = NULL,
  cell_annotation = NULL,
  cell_annotation_palette = "Paired",
  cell_annotation_palcolor = NULL,
  cell_annotation_params = if (flip) {
     list(width = grid::unit(5, "mm"))
 } else {
 
       list(height = grid::unit(5, "mm"))
 },
  feature_annotation = NULL,
  feature_annotation_palette = "Dark2",
  feature_annotation_palcolor = NULL,
  feature_annotation_params = if (flip) {
     list(height = grid::unit(5, "mm"))
 } else
    {
     list(width = grid::unit(5, "mm"))
 },
  separate_annotation = NULL,
  separate_annotation_palette = "Paired",
  separate_annotation_palcolor = NULL,
  separate_annotation_params = if (flip) {
     list(width = grid::unit(10, "mm"))
 }
    else {
     list(height = grid::unit(10, "mm"))
 },
  reverse_ht = NULL,
  use_raster = NULL,
  raster_device = "png",
  raster_by_magick = TRUE,
  height = NULL,
  width = NULL,
  units = "inch",
  seed = 11,
  ht_params = list()
)
}
\arguments{
\item{srt}{A Seurat object.}

\item{lineages}{A character vector specifying the lineages to plot.}

\item{features}{A character vector specifying the features to plot.
By default, this parameter is set to NULL, and the dynamic features will be determined by the parameters
\code{min_expcells}, \code{r.sq}, \code{dev.expl}, \code{padjust} and \code{num_intersections}.}

\item{use_fitted}{Whether to use fitted values. Default is \code{FALSE}.}

\item{border}{Whether to add a border to the heatmap.
Default is \code{TRUE}.}

\item{flip}{Whether to flip the heatmap.
Default is \code{FALSE}.}

\item{min_expcells}{The minimum number of expected cells. Default is \code{20}.}

\item{r.sq}{The R-squared threshold. Default is \code{0.2}.}

\item{dev.expl}{The deviance explained threshold. Default is \code{0.2}.}

\item{padjust}{The p-value adjustment threshold. Default is \code{0.05}.}

\item{num_intersections}{This parameter is a numeric vector used to determine the number of intersections among lineages.
It helps in selecting which dynamic features will be used.
By default, when this parameter is set to \code{NULL},
all dynamic features that pass the specified threshold will be used for each lineage.}

\item{cell_density}{The cell density within each cell bin.
By default, this parameter is set to \code{1}, which means that all cells will be included within each cell bin.}

\item{cell_bins}{The number of cell bins.
Default is \code{100}.}

\item{order_by}{The order of the heatmap.
Default is \code{"peaktime"}.}

\item{layer}{Which layer to use.
Default is \code{"counts"}.}

\item{assay}{Which assay to use.
If \code{NULL}, the default assay of the Seurat object will be used.}

\item{exp_method}{A character vector specifying the method for calculating expression values.
Options are \code{"zscore"}, \code{"raw"}, \code{"fc"}, \code{"log2fc"}, or \code{"log1p"}.
Default is \code{"zscore"}.}

\item{exp_legend_title}{A character vector specifying the title for the legend of expression value.
Default is \code{NULL}.}

\item{limits}{A two-length numeric vector specifying the limits for the color scale.
Default is \code{NULL}.}

\item{lib_normalize}{Whether to normalize the data by library size.}

\item{libsize}{A numeric vector specifying the library size for each cell.
Default is \code{NULL}.}

\item{family}{The model used to calculate the dynamic features if needed.
By default, this parameter is set to \code{NULL}, and the appropriate family will be automatically determined.}

\item{cluster_features_by}{Which lineage to use when clustering features.
By default, this parameter is set to \code{NULL}, which means that all lineages will be used.}

\item{cluster_rows}{Whether to cluster rows in the heatmap.
Default is \code{FALSE}.}

\item{cluster_row_slices}{Whether to cluster row slices in the heatmap.
Default is \code{FALSE}.}

\item{cluster_columns}{Whether to cluster columns in the heatmap.
Default is \code{FALSE}.}

\item{cluster_column_slices}{Whether to cluster column slices in the heatmap.
Default is \code{FALSE}.}

\item{show_row_names}{Whether to show row names in the heatmap.
Default is \code{FALSE}.}

\item{show_column_names}{Whether to show column names in the heatmap.
Default is \code{FALSE}.}

\item{row_names_side}{A character vector specifying the side to place row names.}

\item{column_names_side}{A character vector specifying the side to place column names.}

\item{row_names_rot}{The rotation angle for row names.
Default is \code{0}.}

\item{column_names_rot}{The rotation angle for column names.
Default is \code{90}.}

\item{row_title}{A character vector specifying the title for rows.
Default is \code{NULL}.}

\item{column_title}{A character vector specifying the title for columns.
Default is \code{NULL}.}

\item{row_title_side}{A character vector specifying the side to place row title.
Default is \code{"left"}.}

\item{column_title_side}{A character vector specifying the side to place column title.
Default is \code{"top"}.}

\item{row_title_rot}{The rotation angle for row title.
Default is \code{0}.}

\item{column_title_rot}{The rotation angle for column title.}

\item{feature_split}{A factor specifying how to split the features.
Default is \code{NULL}.}

\item{feature_split_by}{A character vector specifying which group.by to use when splitting features (into n_split feature clusters).
Default is \code{NULL}.}

\item{n_split}{A number of feature splits (feature clusters) to create.
Default is \code{NULL}.}

\item{split_order}{A numeric vector specifying the order of splits.
Default is \code{NULL}.}

\item{split_method}{A character vector specifying the method for splitting features.
Options are \code{"kmeans"}, \code{"hclust"}, or \code{"mfuzz"}.
Default is \code{"kmeans"}.}

\item{decreasing}{Whether to sort feature splits in decreasing order.
Default is \code{FALSE}.}

\item{fuzzification}{The fuzzification coefficient.
Default is \code{NULL}.}

\item{anno_terms}{Whether to include term annotations.
Default is \code{FALSE}.}

\item{anno_keys}{Whether to include key annotations.
Default is \code{FALSE}.}

\item{anno_features}{Whether to include feature annotations.
Default is \code{FALSE}.}

\item{terms_width}{A unit specifying the width of term annotations.
Default is \code{unit(4, "in")}.}

\item{terms_fontsize}{A numeric vector specifying the font size(s) for term annotations.
Default is \code{8}.}

\item{keys_width}{A unit specifying the width of key annotations.
Default is \code{unit(2, "in")}.}

\item{keys_fontsize}{A two-length numeric vector specifying the minimum and maximum font size(s) for key annotations.
Default is \code{c(6, 10)}.}

\item{features_width}{A unit specifying the width of feature annotations.
Default is \code{unit(2, "in")}.}

\item{features_fontsize}{A two-length numeric vector specifying the minimum and maximum font size(s) for feature annotations.
Default is \code{c(6, 10)}.}

\item{IDtype}{A character vector specifying the type of IDs for features.
Default is \code{"symbol"}.}

\item{species}{A character vector specifying the species for features.
Default is \code{"Homo_sapiens"}.}

\item{db_update}{Whether the gene annotation databases should be forcefully updated.
If set to FALSE, the function will attempt to load the cached databases instead.
Default is \code{FALSE}.}

\item{db_version}{A character vector specifying the version of the gene annotation databases to be retrieved.
Default is \code{"latest"}.}

\item{db_combine}{Whether to use a combined database.
Default is \code{FALSE}.}

\item{convert_species}{Whether to use a species-converted database when the annotation is missing for the specified species.
Default is \code{TRUE}.}

\item{Ensembl_version}{An integer specifying the Ensembl version.
Default is \code{NULL}. If \code{NULL}, the latest version will be used.}

\item{mirror}{A character vector specifying the mirror for the Ensembl database.
Default is \code{NULL}.}

\item{db}{A character vector specifying the database to use.
Default is \code{"GO_BP"}.}

\item{TERM2GENE}{A data.frame specifying the TERM2GENE mapping for the database.
Default is \code{NULL}.}

\item{TERM2NAME}{A data.frame specifying the TERM2NAME mapping for the database.
Default is \code{NULL}.}

\item{minGSSize}{An integer specifying the minimum gene set size for the database.
Default is \code{10}.}

\item{maxGSSize}{An integer specifying the maximum gene set size for the database.
Default is \code{500}.}

\item{GO_simplify}{Whether to simplify gene ontology terms.
Default is \code{FALSE}.}

\item{GO_simplify_cutoff}{A character vector specifying the cutoff for GO simplification.
Default is \code{"p.adjust < 0.05"}.}

\item{simplify_method}{A character vector specifying the method for GO simplification.
Default is \code{"Wang"}.}

\item{simplify_similarityCutoff}{The similarity cutoff for GO simplification.
Default is \code{0.7}.}

\item{pvalueCutoff}{A numeric vector specifying the p-value cutoff(s) for significance.
Default is \code{NULL}.}

\item{padjustCutoff}{The adjusted p-value cutoff for significance.
Default is \code{0.05}.}

\item{topTerm}{A number of top terms to include.
Default is \code{5}.}

\item{show_termid}{Whether to show term IDs.
Default is \code{FALSE}.}

\item{topWord}{A number of top words to include.
Default is \code{20}.}

\item{words_excluded}{A character vector specifying the words to exclude.
Default is \code{NULL}.}

\item{nlabel}{A number of labels to include.
Default is \code{20}.}

\item{features_label}{A character vector specifying the features to label.
Default is \code{NULL}.}

\item{label_size}{The size of labels.
Default is \code{10}.}

\item{label_color}{A character vector specifying the color of labels.
Default is \code{"black"}.}

\item{pseudotime_label}{The pseudotime label.
Default is \code{NULL}.}

\item{pseudotime_label_color}{The pseudotime label color.
Default is \code{"black"}.}

\item{pseudotime_label_linetype}{The pseudotime label line type.
Default is \code{2}.}

\item{pseudotime_label_linewidth}{The pseudotime label line width.
Default is \code{3}.}

\item{heatmap_palette}{A character vector specifying the palette to use for the heatmap.
Default is \code{"RdBu"}.}

\item{heatmap_palcolor}{A character vector specifying the heatmap color to use.
Default is \code{NULL}.}

\item{pseudotime_palette}{The color palette to use for pseudotime.
Default is \code{"cividis"}.}

\item{pseudotime_palcolor}{The colors to use for the pseudotime in the heatmap.
Default is \code{NULL}.}

\item{feature_split_palette}{A character vector specifying the palette to use for feature splits.
Default is \code{"simspec"}.}

\item{feature_split_palcolor}{A character vector specifying the feature split color to use.
Default is \code{NULL}.}

\item{cell_annotation}{A character vector specifying the cell annotation(s) to include.
Default is \code{NULL}.}

\item{cell_annotation_palette}{A character vector specifying the palette to use for cell annotations.
The length of the vector should match the number of cell_annotation.
Default is \code{"Paired"}.}

\item{cell_annotation_palcolor}{A list of character vector specifying the cell annotation color(s) to use.
The length of the list should match the number of cell_annotation.
Default is \code{NULL}.}

\item{cell_annotation_params}{A list specifying additional parameters for cell annotations.
Default is a list with \code{width = unit(1, "cm")} if flip is TRUE, else a list with \code{height = unit(1, "cm")}.}

\item{feature_annotation}{A character vector specifying the feature annotation(s) to include.
Default is \code{NULL}.}

\item{feature_annotation_palette}{A character vector specifying the palette to use for feature annotations.
The length of the vector should match the number of feature_annotation.
Default is \code{"Dark2"}.}

\item{feature_annotation_palcolor}{A list of character vector specifying the feature annotation color to use.
The length of the list should match the number of feature_annotation.
Default is \code{NULL}.}

\item{feature_annotation_params}{A list specifying additional parameters for feature annotations.
Default is \code{list()}.}

\item{separate_annotation}{Names of the annotations to be displayed in separate annotation blocks.
Each name should match a column name in the metadata of the \code{Seurat} object.}

\item{separate_annotation_palette}{The color palette to use for separate annotations.
Default is \code{"Paired"}.}

\item{separate_annotation_palcolor}{The colors to use for each level of the separate annotations.
Default is \code{NULL}.}

\item{separate_annotation_params}{Other parameters to \link[ComplexHeatmap:HeatmapAnnotation]{ComplexHeatmap::HeatmapAnnotation} when creating a separate annotation blocks.}

\item{reverse_ht}{Whether to reverse the heatmap.
Default is \code{NULL}.}

\item{use_raster}{Whether to use a raster device for plotting.
Default is \code{NULL}.}

\item{raster_device}{A character vector specifying the raster device to use.
Default is \code{"png"}.}

\item{raster_by_magick}{Whether to use the 'magick' package for raster.
Default is \code{FALSE}.}

\item{height}{A numeric vector specifying the height(s) of the heatmap body.
Default is \code{NULL}.}

\item{width}{A numeric vector specifying the width(s) of the heatmap body.
Default is \code{NULL}.}

\item{units}{A character vector specifying the units for the height and width.
Default is \code{"inch"}.}

\item{seed}{Random seed for reproducibility.
Default is \code{11}.}

\item{ht_params}{Additional parameters to customize the appearance of the heatmap.
This should be a list with named elements, where the names correspond to parameter names in the \link[ComplexHeatmap:Heatmap]{ComplexHeatmap::Heatmap} function.
Any conflicting parameters will override the defaults set by this function.
Default is \code{list()}.}
}
\description{
Heatmap plot for dynamic features along lineages
}
\examples{
options(log_message.verbose = FALSE)
data(pancreas_sub)
pancreas_sub <- standard_scop(pancreas_sub)

pancreas_sub <- RunSlingshot(
  pancreas_sub,
  group.by = "SubCellType",
  reduction = "UMAP"
)
pancreas_sub <- RunDynamicFeatures(
  pancreas_sub,
  lineages = c("Lineage1", "Lineage2"),
  n_candidates = 200
)

ht1 <- DynamicHeatmap(
  pancreas_sub,
  lineages = "Lineage1",
  n_split = 5,
  split_method = "kmeans-peaktime",
  cell_annotation = "SubCellType"
)
ht1$plot

thisplot::panel_fix(ht1$plot, raster = TRUE, dpi = 50)

ht2 <- DynamicHeatmap(
  pancreas_sub,
  lineages = "Lineage1",
  features = c(
    "Sox9",
    "Neurod2",
    "Isl1",
    "Rbp4",
    "Pyy", "S_score", "G2M_score"
  ),
  cell_annotation = "SubCellType"
)
ht2$plot

thisplot::panel_fix(
  ht2$plot,
  height = 5,
  width = 5,
  raster = TRUE,
  dpi = 50
)

ht3 <- DynamicHeatmap(
  pancreas_sub,
  lineages = c("Lineage1", "Lineage2"),
  n_split = 5,
  split_method = "kmeans",
  cluster_rows = TRUE,
  cell_annotation = "SubCellType"
)
ht3$plot

ht4 <- DynamicHeatmap(
  pancreas_sub,
  lineages = c("Lineage1", "Lineage2"),
  reverse_ht = "Lineage1",
  cell_annotation = "SubCellType",
  n_split = 5,
  split_method = "mfuzz",
  species = "Mus_musculus",
  db = "GO_BP",
  anno_terms = TRUE,
  anno_keys = TRUE,
  anno_features = TRUE
)
ht4$plot

\dontrun{
pancreas_sub <- AnnotateFeatures(
  pancreas_sub,
  species = "Mus_musculus",
  db = c("CSPA", "TF")
)
ht5 <- DynamicHeatmap(
  pancreas_sub,
  lineages = c("Lineage1", "Lineage2"),
  reverse_ht = "Lineage1",
  use_fitted = TRUE,
  n_split = 6,
  split_method = "mfuzz",
  heatmap_palette = "viridis",
  cell_annotation = c(
    "SubCellType", "Phase", "G2M_score"
  ),
  cell_annotation_palette = c(
    "Paired", "simspec", "Purples"
  ),
  separate_annotation = list(
    "SubCellType", c("Arxes1", "Ncoa2")
  ),
  separate_annotation_palette = c(
    "Paired", "Set1"
  ),
  separate_annotation_params = list(
    height = grid::unit(10, "mm")
  ),
  feature_annotation = c("TF", "CSPA"),
  feature_annotation_palcolor = list(
    c("gold", "steelblue"),
    c("forestgreen")
  ),
  pseudotime_label = 25,
  pseudotime_label_color = "red"
)
ht5$plot

ht6 <- DynamicHeatmap(
  pancreas_sub,
  lineages = c("Lineage1", "Lineage2"),
  reverse_ht = "Lineage1",
  use_fitted = TRUE,
  n_split = 6,
  split_method = "mfuzz",
  heatmap_palette = "viridis",
  cell_annotation = c(
    "SubCellType", "Phase", "G2M_score"
  ),
  cell_annotation_palette = c(
    "Paired", "simspec", "Purples"
  ),
  separate_annotation = list(
    "SubCellType", c("Arxes1", "Ncoa2")
  ),
  separate_annotation_palette = c("Paired", "Set1"),
  separate_annotation_params = list(width = grid::unit(10, "mm")),
  feature_annotation = c("TF", "CSPA"),
  feature_annotation_palcolor = list(
    c("gold", "steelblue"),
    c("forestgreen")
  ),
  pseudotime_label = 25,
  pseudotime_label_color = "red",
  flip = TRUE, column_title_rot = 45
)
ht6$plot
}
}
\seealso{
\link{RunDynamicFeatures}, \link{RunDynamicEnrichment}
}
